<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
  .covered {
    background-color: green;
  }
  .uncovered {
    background-color: red;
  }
  .coverage {
    font-size: 0.8em;
    color: #333;
  }
  .coverage.fullCoverage {
    background-color:#0f0;
    color: #111;
  }
  .coverage.okCoverage {
    background-color: orange;
  }
  .coverage.poorCoverage {
    background-color: red;
  }
  .code {
    font-family: "Consolas", "Courier New", Courier, mono;
    white-space: pre;
    line-height: 16px;
  }
  .collapsed {
    display: none;
  }
  body {
    margin-left: 20px;
    margin-top: 8px;
    background-color: white;
    color: black;
    font-size: 16px;
  }
  ol {
    margin-left: 20px;
    margin-bottom: 40px;
    width: 800px;
    line-height: 18px;
    -moz-box-shadow: 10px 10px 5px #888;
    -webkit-box-shadow: 10px 10px 5px #888;
    box-shadow: 10px 10px 5px #888;
  }
  </style>
  <script type="text/javascript">
    function expando(elem) {
      // We're skipping the '/n' text element sibling.
      var olElement= elem.nextSibling.nextSibling;
      var currentState= olElement.className;
      if( currentState == "collapsed" ) currentState= "";
      else currentState= "collapsed";
      olElement.className= currentState;
    }
  </script>
</head>
<body>
<h2>oauth.js</h2>
<span class="coverage poorCoverage">[ hits: 109, misses: 74, sloc: 183, coverage: 59.56% ]</span> <a href='#' onclick='expando(this)'>[+]</a>
<ol class='collapsed'>
  <li class="code covered" coverage="1">var http = require('http'),</li>
  <li class="code covered" coverage="">	https = require('https'),</li>
  <li class="code covered" coverage="">	querystring = require('querystring'),</li>
  <li class="code covered" coverage="">	url = require('url'),</li>
  <li class="code covered" coverage="">	crypto = require('crypto'),</li>
  <li class="code covered" coverage="">	util = require('util'),</li>
  <li class="code covered" coverage="">	uuid = require('node-uuid');</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function _encodeURI(str) {</li>
  <li class="code covered" coverage="">	// https://developer.mozilla.org/En/Core_javascript_1.5_reference:global_functions:encodeuricomponent</li>
  <li class="code covered" coverage="290">	return encodeURIComponent(str).</li>
  <li class="code covered" coverage="">	replace(/!/g, '%21').</li>
  <li class="code covered" coverage="">	replace(/'/g, '%27').</li>
  <li class="code covered" coverage="">	replace(/\(/g, '%28').</li>
  <li class="code covered" coverage="">	replace(/\)/g, '%29').</li>
  <li class="code covered" coverage="">	replace(/\*/g, '%2A');</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function percentEncodeURI(str) {</li>
  <li class="code uncovered" coverage="0">	return encodeURIComponent(str).replace(/%/g,'%25');</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function sortKeys (obj, fn) {</li>
  <li class="code covered" coverage="21">	if (!obj) {</li>
  <li class="code uncovered" coverage="0">		return obj;</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="21">	var vals = Object.keys(obj).sort(fn);</li>
  <li class="code covered" coverage="21">	var sorted = {};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="21">	for(var i = 0; i &lt; vals.length; i++) {</li>
  <li class="code covered" coverage="124">		sorted[vals[i]] = obj[vals[i]];</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="21">	obj = sorted;</li>
  <li class="code covered" coverage="21">	return obj;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.version = '1.0';</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.merge = function(a,b) {</li>
  <li class="code covered" coverage="4">	if (!b || !(b instanceof Object)) {</li>
  <li class="code covered" coverage="3">		return a;</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">	</li>
  <li class="code covered" coverage="1">	var keys = Object.keys(b);</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">	for (var key in keys) {</li>
  <li class="code covered" coverage="1">		if(typeof(keys[key]) != 'function') {</li>
  <li class="code covered" coverage="1">			a[keys[key]] = b[keys[key]];</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="1">	return a;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.normalize = function(obj)</li>
  <li class="code covered" coverage="">{</li>
  <li class="code covered" coverage="21">	if (!(obj instanceof Object)) {</li>
  <li class="code uncovered" coverage="0">		return obj;</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="21">	obj = sortKeys(obj);</li>
  <li class="code covered" coverage="21">	for(var prop in obj) {</li>
  <li class="code covered" coverage="124">		if (typeof(obj[prop]) === 'function') {</li>
  <li class="code covered" coverage="1">			delete obj[prop];</li>
  <li class="code covered" coverage="1">			continue;</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="123">		if (obj[prop].constructor === Array) {</li>
  <li class="code uncovered" coverage="0">			obj[prop] = obj[prop].sort();</li>
  <li class="code uncovered" coverage="0">			for(var child in obj[prop]) {</li>
  <li class="code uncovered" coverage="0">				prop[child] = oauth.normalize(child);</li>
  <li class="code covered" coverage="">			}</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="123">		else if (obj[prop] instanceof Object) {</li>
  <li class="code uncovered" coverage="0">			obj[prop] = oauth.normalize(obj[prop]);</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="21">	return obj;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.fillURL = function(path, host, port, secure) {</li>
  <li class="code covered" coverage="5">	var p = url.parse(path);</li>
  <li class="code covered" coverage="5">	p.protocol =  p.protocol  || (secure ? 'https:' : 'http:');</li>
  <li class="code covered" coverage="5">	p.hostname =  p.hostname  || host;</li>
  <li class="code covered" coverage="5">	p.port     =  p.port      || port;</li>
  <li class="code covered" coverage="5">	return url.format(p);</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.normalizeURL = function(path) {</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="35">	debugger;</li>
  <li class="code covered" coverage="35">	var p = url.parse(path.replace(/^https/i, 'https').replace(/^http/i, 'http'));</li>
  <li class="code covered" coverage="35">	var ret = {</li>
  <li class="code covered" coverage="">		protocol: p.protocol,</li>
  <li class="code covered" coverage="">		hostname: p.hostname,</li>
  <li class="code covered" coverage="">		pathname: p.pathname,</li>
  <li class="code covered" coverage="">		port:     p.port,</li>
  <li class="code covered" coverage="">		slashes:  true</li>
  <li class="code covered" coverage="">	};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="35">	if ((p.port == 80 &amp;&amp; p.protocol == 'http:') || </li>
  <li class="code covered" coverage="">		(p.port == 443 &amp;&amp; p.protocol == 'https:')) {</li>
  <li class="code covered" coverage="6">		delete ret.port;</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="35">	ret.protocol = ret.protocol.toLowerCase();</li>
  <li class="code covered" coverage="35">	ret.hostname = ret.hostname.toLowerCase();</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="35">	return url.format(ret);</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.request = function(options, callback) {</li>
  <li class="code uncovered" coverage="0">	debugger;</li>
  <li class="code uncovered" coverage="0">	if(!options.oauth_signature) {</li>
  <li class="code uncovered" coverage="0">		return http.request(options, callback);</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var default_headers = {</li>
  <li class="code covered" coverage="">		'content-type': 'application/x-www-form-urlencoded',</li>
  <li class="code covered" coverage="">		'host': options.host,</li>
  <li class="code covered" coverage="">		'accept': '*/*',</li>
  <li class="code covered" coverage="">		'www-authenticate': 'OAuth realm=' + (options.https ? 'https' : 'http') + '://' + options.host</li>
  <li class="code covered" coverage="">	};</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	if(!options.headers) {</li>
  <li class="code uncovered" coverage="0">		options.headers = default_headers;</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">	else {</li>
  <li class="code uncovered" coverage="0">		exports.merge(default_headers, options.headers);</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var uri = exports.fillURL(options.path, options.host, options.port, options.https);</li>
  <li class="code uncovered" coverage="0">	options.headers = signRequest(options.method, uri, options.headers, </li>
  <li class="code covered" coverage="">		options.body, options.oauth_signature);</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var req;</li>
  <li class="code uncovered" coverage="0">	if (options.https) {</li>
  <li class="code uncovered" coverage="0">		req = https.request(options, callback);</li>
  <li class="code covered" coverage="">	} else {</li>
  <li class="code uncovered" coverage="0">		req = http.request(options, callback);</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">	</li>
  <li class="code uncovered" coverage="0">	req.write = function(chunk, normalize) {</li>
  <li class="code uncovered" coverage="0">		if (normalize || options.body) {</li>
  <li class="code uncovered" coverage="0">			chunk = normalizeBody(chunk);</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="">		</li>
  <li class="code uncovered" coverage="0">		return http.ClientRequest.prototype.write.call(this, chunk, 'utf-8');</li>
  <li class="code covered" coverage="">	};</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	return req;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function signRequest(method, path, headers, body, signature) {</li>
  <li class="code uncovered" coverage="0">	var auth = {</li>
  <li class="code covered" coverage="">		'oauth_nonce': nonce(),</li>
  <li class="code covered" coverage="">		'oauth_timestamp': timestamp(),</li>
  <li class="code covered" coverage="">		'oauth_signature_method':signature.name,</li>
  <li class="code covered" coverage="">		'oauth_version':exports.version</li>
  <li class="code covered" coverage="">	};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="">	// split out any oauth_* params in the querystring and merge them into</li>
  <li class="code covered" coverage="">	// the authorization header</li>
  <li class="code uncovered" coverage="0">	var parsed = url.parse(path);</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var params = null;</li>
  <li class="code covered" coverage="">	// if any parameters are passed with the path we need them</li>
  <li class="code uncovered" coverage="0">	if(parsed.query) {</li>
  <li class="code uncovered" coverage="0">		params = querystring.parse(parsed.query);</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var removed = splitParams(parsed.query);</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var t = signature.token;</li>
  <li class="code uncovered" coverage="0">	var c = signature.consumer;</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	exports.merge(auth, removed ? removed : null);</li>
  <li class="code uncovered" coverage="0">	exports.merge(auth, t ? Token.prototype.encode.call(t) : null);</li>
  <li class="code uncovered" coverage="0">	exports.merge(auth, c ? c.encode() : null);</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	var base64;</li>
  <li class="code uncovered" coverage="0">	var joined = {};</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	exports.merge(joined, body ? body : null);</li>
  <li class="code uncovered" coverage="0">	exports.merge(joined, auth);</li>
  <li class="code uncovered" coverage="0">	exports.merge(joined, params);</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	if (signature instanceof HMAC) {</li>
  <li class="code uncovered" coverage="0">		base64 = signature.sign(method, path, joined);</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code uncovered" coverage="0">	else if (signature instanceof Signature) {</li>
  <li class="code uncovered" coverage="0">		base64 = signature.sign();</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">	else {</li>
  <li class="code uncovered" coverage="0">		throw new TypeError("Invalid signature type");</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">	</li>
  <li class="code uncovered" coverage="0">	var esc = querystring.escape;</li>
  <li class="code uncovered" coverage="0">	querystring.escape = _encodeURI;</li>
  <li class="code uncovered" coverage="0">	auth = querystring.stringify(exports.normalize(auth), '\",', '=\"');</li>
  <li class="code uncovered" coverage="0">	querystring.escape = esc;</li>
  <li class="code covered" coverage=""></li>
  <li class="code uncovered" coverage="0">	headers.authorization = "OAuth " + auth + '\",oauth_signature=\"' + _encodeURI(base64) + '\"';</li>
  <li class="code uncovered" coverage="0">	return headers;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function nonce() {</li>
  <li class="code uncovered" coverage="0">	return uuid();</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function normalizeBody(chunk) {</li>
  <li class="code uncovered" coverage="0">	var esc = querystring.escape;</li>
  <li class="code uncovered" coverage="0">	querystring.escape = function(str) { return encodeURIComponent(str).replace('%20','+'); };</li>
  <li class="code uncovered" coverage="0">	querystring.escape = esc;</li>
  <li class="code uncovered" coverage="0">	return querystring.stringify(chunk);</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function splitParams(obj) {</li>
  <li class="code uncovered" coverage="0">	var removed = null;</li>
  <li class="code uncovered" coverage="0">	for (var prop in obj) {</li>
  <li class="code uncovered" coverage="0">		if (/^oauth_\w+$/.test(prop)) {</li>
  <li class="code uncovered" coverage="0">			if(!removed) {</li>
  <li class="code uncovered" coverage="0">				removed = {};</li>
  <li class="code covered" coverage="">			}</li>
  <li class="code uncovered" coverage="0">			removed[prop] = obj[prop];</li>
  <li class="code uncovered" coverage="0">			delete obj[prop];</li>
  <li class="code covered" coverage="">		}</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code uncovered" coverage="0">	return removed;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function timestamp() {</li>
  <li class="code uncovered" coverage="0">	return (new Date().getTime() / 1000) | 0;</li>
  <li class="code covered" coverage="">}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function Consumer() {}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.Consumer = Consumer;</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.createConsumer = function(key,secret) {</li>
  <li class="code covered" coverage="10">	var c = new Consumer();</li>
  <li class="code covered" coverage="10">	c.oauth_consumer_key = key;</li>
  <li class="code covered" coverage="10">	c.oauth_consumer_secret = secret;</li>
  <li class="code covered" coverage="10">	return c;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Consumer.prototype.decode = function(str) {</li>
  <li class="code covered" coverage="1">	var parsed = querystring.parse(str);</li>
  <li class="code covered" coverage="1">	for (var prop in parsed) {</li>
  <li class="code covered" coverage="2">		this[prop] = parsed[prop];</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Consumer.prototype.encode = function() {</li>
  <li class="code covered" coverage="2">	return {</li>
  <li class="code covered" coverage="">		oauth_consumer_key: this.oauth_consumer_key</li>
  <li class="code covered" coverage="">	};</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="2">function Token() {};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.Token = Token;</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.createToken = function(key, secret) {</li>
  <li class="code covered" coverage="10">	var t = new Token();</li>
  <li class="code covered" coverage="10">	t.oauth_token = key || '';</li>
  <li class="code covered" coverage="10">	t.oauth_token_secret = secret || '';</li>
  <li class="code covered" coverage="10">	return t;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Token.prototype.decode = function(str) {</li>
  <li class="code covered" coverage="1">	var parsed = querystring.parse(str);</li>
  <li class="code covered" coverage="1">	for(var prop in parsed) {</li>
  <li class="code covered" coverage="2">		this[prop] = parsed[prop];</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Token.prototype.encode = function(str) {</li>
  <li class="code covered" coverage="1">	var ret = { oauth_token: this.oauth_token };</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">	if(this.oauth_verifier) {</li>
  <li class="code uncovered" coverage="0">		merge(ret, { oauth_verifier: this.oauth_verifier });</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">	return ret;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function Signature(){}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.Signature = Signature;</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.createSignature = function(consumer, token) {</li>
  <li class="code uncovered" coverage="0">	var p = new Signature();</li>
  <li class="code uncovered" coverage="0">	p.consumer = consumer;</li>
  <li class="code uncovered" coverage="0">	p.token = token;</li>
  <li class="code uncovered" coverage="0">	p.name = 'PLAINTEXT';</li>
  <li class="code uncovered" coverage="0">	return p;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Signature.prototype.key = function() {</li>
  <li class="code covered" coverage="7">	return [</li>
  <li class="code covered" coverage="">		_encodeURI(this.consumer ? this.consumer.oauth_consumer_secret : ''),</li>
  <li class="code covered" coverage="">		_encodeURI(this.token ? this.token.oauth_token_secret : '')</li>
  <li class="code covered" coverage="">	].join('&amp;');</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Signature.prototype.sign = function() {</li>
  <li class="code uncovered" coverage="0">	return key;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">Signature.prototype.baseString = function(method, url, params) {</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="20">	querystring.escape = _encodeURI;</li>
  <li class="code covered" coverage="">	</li>
  <li class="code covered" coverage="20">	var baseString = [</li>
  <li class="code covered" coverage="">		method.toUpperCase(),</li>
  <li class="code covered" coverage="">		_encodeURI(exports.normalizeURL(url)),</li>
  <li class="code covered" coverage="">		_encodeURI(querystring.stringify(exports.normalize(params)))</li>
  <li class="code covered" coverage="">	].join('&amp;');</li>
  <li class="code covered" coverage="">	</li>
  <li class="code covered" coverage="20">	return baseString;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">function HMAC() {}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">util.inherits(HMAC, Signature);</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.HMAC = HMAC;</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">exports.createHmac = function(consumer,token) {</li>
  <li class="code covered" coverage="7">	var h = new HMAC(consumer, token);</li>
  <li class="code covered" coverage="7">	h.algo = 'sha1';</li>
  <li class="code covered" coverage="7">	h.encoding = 'base64';</li>
  <li class="code covered" coverage="7">	h.name = 'HMAC-SHA1';</li>
  <li class="code covered" coverage="7">	h.consumer = consumer;</li>
  <li class="code covered" coverage="7">	h.token = token;</li>
  <li class="code covered" coverage="7">	return h;</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">HMAC.prototype.base = function(method,path,params) {</li>
  <li class="code covered" coverage="6">	return this.baseString(method, path, params);</li>
  <li class="code covered" coverage="">};</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="1">HMAC.prototype.sign = function(method,path,params) {</li>
  <li class="code covered" coverage="6">	if (!this.consumer &amp;&amp; !this.token) {</li>
  <li class="code uncovered" coverage="0">		throw new Error('Must provide a valid consumer or token');</li>
  <li class="code covered" coverage="">	}</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="6">	var base = this.baseString(method, path, params);</li>
  <li class="code covered" coverage="6">	var hmac = crypto.createHmac(this.algo, this.key());</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="6">	hmac.update(base);</li>
  <li class="code covered" coverage=""></li>
  <li class="code covered" coverage="6">	return hmac.digest(this.encoding);</li>
  <li class="code covered" coverage="">};</li>
</ol>
<hr/>
</body>
</html>